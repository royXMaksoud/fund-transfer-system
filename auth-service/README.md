# Auth Service

This service handles user authentication and registration using JWT tokens. It is a part of the **Fund Transfer Platform** project and provides secure login, registration, token generation, and token refreshing functionalities.

## 🔐 Features

- User Registration and Login
- JWT Token Generation
- Refresh Token Support
- Role-based Claims
- Swagger UI for API Testing
- Global Exception Handling
- PostgreSQL Integration
- Account Locking after Multiple Failed Login Attempts

## 🚀 Exposed Endpoints

| Method | Path                       | Description                         | Secured |
|--------|----------------------------|-------------------------------------|---------|
| POST   | /auth/register             | Register a new user                 | ❌      |
| POST   | /auth/login                | Login and receive JWT + refresh     | ❌      |
| POST   | /auth/refresh              | Get new JWT using refresh token     | ✅      |
| GET    | /auth/user/profile         | Get current user profile            | ✅      |

## 🛡️ Security

- JWT is generated upon successful login and contains `username` and `role` claims.
- **Refresh tokens** are stored securely in the database (`refresh_tokens` table) with expiration.
- **Account locking** is implemented after 5 failed login attempts, with a cooldown period of 30 minutes.
- Global exception handling using `@RestControllerAdvice` to return standardized error responses.
- JWT is required for accessing secured endpoints, and it should be included in the `Authorization` header.

## 🔧 Technologies

- Java 17
- Spring Boot 3
- Spring Security + JWT
- PostgreSQL Database
- Swagger UI (springdoc-openapi)
- Clean Architecture (Layered structure with separation of concerns)

## 🧪 Test via Swagger

You can test the Auth Service API through **Swagger UI**, accessible via the API Gateway:

```
http://localhost:9090/webjars/swagger-ui/index.html
```

Auth Service Docs can be found under the **`auth-service`** section.

## 🔗 Dependencies

- **fund-transfer-service**: Uses JWT generated by the auth-service to authenticate users.
- **gateway-service**: Routes requests to this service and handles API Gateway functionality.

## 🗄️ Configuration

### `application.yml`

```yaml
server:
  port: 8080

spring:
  application:
    name: auth-service

  datasource:
    url: jdbc:postgresql://localhost:5432/fund_transfer_db
    username: postgres
    password: P@ssw0rd
    driver-class-name: org.postgresql.Driver

  jpa:
    hibernate:
      ddl-auto: update
    show-sql: true
    properties:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect

  springdoc:
    api-docs:
      path: /v3/api-docs
    swagger-ui:
      path: /swagger-ui.html

jwt:
  secret: SuperSecureKeyThatIsAtLeast64CharactersLongToAvoidWeakKeyException1234567890
  expiration: 86400000  # 24 hours in milliseconds
```

## 📂 Package Structure

- `domain`: Contains business logic, domain models, and ports (interfaces for communication).
- `web`: Contains controllers, REST endpoints, and DTOs (Data Transfer Objects).
- `infrastructure`: Contains the database configuration, JPA repositories, and security logic.

## 📌 Notes

- **Refresh token** is stored in the database and should be managed carefully (e.g., expire after a set period).
- **Security filter chain** is configured to allow `/auth/**` and Swagger endpoints.
- **Global error handling** is implemented to standardize error messages and provide more clarity to the user.

---

✅ **Ready for integration with API Gateway**.